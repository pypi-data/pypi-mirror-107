(self.webpackChunk_jupyrdf_jupyter_elk=self.webpackChunk_jupyrdf_jupyter_elk||[]).push([[73],{4614:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ELKLayoutModel:()=>p,ELKTextSizerModel:()=>u,ELKTextSizerView:()=>c});var l=s(6168),n=s(8081),i=s(719),o=s(4005),a=s.n(o),r=s(8036),d=s(6486);class u extends n.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:u.model_name,_model_module_version:r.q4,_view_module:r.A1,_view_name:c.view_name,_view_module_version:r.q4,id:String(Math.random()),inlet:null,outlet:null})}initialize(e,t){super.initialize(e,t),r.ZF&&console.warn("ELK Test Sizer Init"),this.on("msg:custom",this.handleMessage,this),window.sizer=this,r.ZF&&console.warn("ELK Text Done Init")}make_container(){const e=document.createElement("div"),t=this.get("_dom_classes").filter((e=>0===e.indexOf("styled-widget-")))[0];e.classList.add("p-Widget",r.gJ.widget_class,r.gJ.sizer_class,t);const s=this.get("namespaced_css");return e.innerHTML=`<div class="sprotty"><style>${s}</style><svg class="sprotty-graph"><g></g></svg></div>`,e}make_label(e){var t,s;r.ZF&&console.warn("ELK Text Label for text",e);let l=g("text"),n=[r.gJ.label];return(null===(t=e.properties)||void 0===t?void 0:t.cssClasses.length)>0&&(n=n.concat(null===(s=e.properties)||void 0===s?void 0:s.cssClasses.split(" "))),l.classList.add(...n),l.textContent=e.text,r.ZF&&console.warn("ELK Text Label",l),l}handleMessage(e){switch(e.action){case"run":this.measure()}}measure(){var e;const t=null===(e=this.get("inlet"))||void 0===e?void 0:e.get("value");let s=this.get("outlet");if(null==t||null==s)return null;r.ZF&&console.log("Root Node:",t);let l=h(t);r.ZF&&console.warn("ELK Text Sizer Measure",l);const n=this.make_container(),i=n.getElementsByTagName("g")[0],o=g("g");l.forEach((e=>{o.appendChild(this.make_label(e))})),i.appendChild(o),r.ZF&&console.warn("ELK Text Sizer to add node",o),r.ZF&&console.warn("ELK Text Sizer node",i),document.body.prepend(n);let a=Array.from(o.getElementsByTagName("text"));r.ZF&&console.warn("Sized Text"),window.requestAnimationFrame((()=>{this.read_sizes(l,a);let e=Object.assign({},t);e.out=(0,d.random)(),s.set("value",e),s.save_changes(),r.ZF||document.body.removeChild(n)}))}read_sizes(e,t){let s=0;for(let l of t){r.ZF&&console.warn(l.innerHTML);const t=e[s],n=l.getBoundingClientRect();t.width=n.width,t.height=n.height,s++}}}u.model_name="ELKTextSizerModel",u.serializers=Object.assign(Object.assign({},n.DOMWidgetModel.serializers),{inlet:{deserialize:n.unpack_models},outlet:{deserialize:n.unpack_models}});class c extends n.DOMWidgetView{async render(){}}function g(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function h(e){let t=[];if(null==e?void 0:e.labels)for(let s of e.labels)(null==s?void 0:s.width)&&(null==s?void 0:s.height)||t.push(s);for(let s of(null==e?void 0:e.ports)||[])t.push(...h(s));for(let s of(null==e?void 0:e.children)||[])t.push(...h(s));for(let s of(null==e?void 0:e.edges)||[])t.push(...h(s));for(let s of(null==e?void 0:e.labels)||[])t.push(...h(s));return t}c.view_name="ELKTextSizerView";const m=new(a())({workerFactory:()=>(r.ZF&&console.warn("ELK Worker created"),new i.Z)});class p extends n.DOMWidgetModel{constructor(){super(...arguments),this.layoutUpdated=new l.Signal(this)}defaults(){return Object.assign(Object.assign({},super.defaults()),{_view_module:r.A1,_model_name:p.model_name,_model_module_version:r.q4,inlet:null,outlet:null})}initialize(e,t){super.initialize(e,t),this.on("msg:custom",this.handleMessage,this)}ensureElk(){null==this._elk&&(this._elk=m)}handleMessage(e){switch(e.action){case"run":this.layout()}}async layout(){var e;const t=null===(e=this.get("inlet"))||void 0===e?void 0:e.get("value");let s=this.get("outlet");if(null==t||null==s)return null;let l,n=function(e){let t=new Map;return function e(s){t[s.id]=s.properties,delete s.properties,s.children&&s.children.map(e),s.ports&&s.ports.map(e),s.labels&&s.labels.map(e),s.edges&&s.edges.map(e)}(e),t}(t);this.ensureElk();try{l=await this._elk.layout(t),i=n,function e(t){t.properties=i[t.id],t.children&&t.children.map(e),t.ports&&t.ports.map(e),t.labels&&t.labels.map(e),t.edges&&t.edges.map(e)}(l)}catch(e){l={},console.error(e)}var i;return s.set("value",Object.assign({},l)),s.save_changes(),l}}p.model_name="ELKLayoutModel",p.serializers=Object.assign(Object.assign({},n.DOMWidgetModel.serializers),{inlet:{deserialize:n.unpack_models},outlet:{deserialize:n.unpack_models}})}}]);