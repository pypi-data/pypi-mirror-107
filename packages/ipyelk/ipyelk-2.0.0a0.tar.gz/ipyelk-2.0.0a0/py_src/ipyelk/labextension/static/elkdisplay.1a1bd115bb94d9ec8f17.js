(self.webpackChunk_jupyrdf_jupyter_elk=self.webpackChunk_jupyrdf_jupyter_elk||[]).push([[555],{3213:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ELKViewerModel:()=>je,ELKViewerView:()=>Oe}),s(6218);var i=s(1966),o=s.n(i),n=s(6168),r=s(8081),l=s(3409),a=s(8036),d=s(6700);let c=class extends l.UpdateModelCommand{computeAnimation(e,t,s){const i={fades:[]};(0,l.forEachMatch)(t,((t,o)=>{if(void 0!==o.left&&void 0!==o.right)this.updateElement(o.left,o.right,i);else if(void 0!==o.right){const e=o.right;(0,l.isFadeable)(e)&&(e.opacity=0,i.fades.push({element:e,type:"in"}))}else if(o.left instanceof l.SChildElement){const t=o.left;if((0,l.isFadeable)(t)&&void 0!==o.leftParentId&&!function(e,t){const s=t=>t.some((t=>(t=>void 0!==e.index.getById(t.id))(t)||s(t.children)));return s([t])}(e,t)){const n=e.index.getById(o.leftParentId);if(n instanceof l.SParentElement){const e=s.modelFactory.createElement(t);n.add(e),i.fades.push({element:e,type:"out"})}}}}));const o=this.createAnimations(i,e,s);return o.length>=2?new l.CompoundAnimation(e,s,o):1===o.length?o[0]:e}};c=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],c);const u=new d.ContainerModule(((e,t,s)=>{(0,l.configureCommand)({bind:e,isBound:s},c)}));function h(e,t=""){return null==e||0==e.length?t:e}function p(e){var t;let s=((null===(t=e.properties)||void 0===t?void 0:t.cssClasses)||"").trim();return s?s.split(" "):[]}class g{constructor(){this.nodeIds=new Set,this.edgeIds=new Set,this.portIds=new Set,this.labelIds=new Set,this.sectionIds=new Set,this.symbolsIds=new Map,this.connectors=new Map}transform(e,t,s){const i={type:"graph",id:e.id||"root",children:[],cssClasses:p(e),symbols:this.transformSymbols(t,s)};if(e.children){const t=e.children.map(this.transformElkNode,this);i.children.push(...t)}if(e.edges){const t=e.edges.map(this.transformElkEdge,this);i.children.push(...t)}return i}transformSymbols(e,t){let s=[];for(const i in e.library)s.push(this.transformSymbol(i,e.library[i],t));return{children:s}}transformSymbol(e,t,s){let i=null==t?void 0:t.element,o=[];return i&&(o=[this.transformSymbolElement(i)]),this.symbolsIds[e]=`${s}_${e}`,(t.hasOwnProperty("symbol_offset")||t.hasOwnProperty("path_offset"))&&(this.connectors[e]=t),{type:"symbol",id:e,children:o,position:this.pos(t),size:this.size(t),properties:t.properties}}transformSymbolElement(e){var t,s;e.properties.isSymbol=!0;let i={id:e.id,position:this.pos(e),size:this.size(e),cssClasses:p(e),children:[],properties:e.properties,type:h(null===(s=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"node")};const o=e.children.map(this.transformSymbolElement,this);return i.children.push(...o),i}transformElkNode(e){var t,s;this.checkAndRememberId(e,this.nodeIds);const i={type:h(null===(s=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"node"),id:e.id,position:this.pos(e),size:this.size(e),children:[],cssClasses:p(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.children){const t=e.children.map(this.transformElkNode,this);i.children.push(...t)}if(e.ports){const t=e.ports.map(this.transformElkPort,this);i.children.push(...t)}if(e.labels){const t=e.labels.map(this.transformElkLabel,this);i.children.push(...t)}if(e.edges){const t=e.edges.map(this.transformElkEdge,this);i.children.push(...t)}return i}transformElkPort(e){var t,s;this.checkAndRememberId(e,this.portIds);const i={type:h(null===(s=null===(t=e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"port"),id:e.id,position:this.pos(e),size:this.size(e),children:[],cssClasses:p(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.labels){const t=e.labels.map(this.transformElkLabel,this);i.children.push(...t)}return i}transformElkLabel(e){var t,s;this.checkAndRememberId(e,this.labelIds);let i={type:h(null===(s=null===(t=e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"label"),id:e.id,text:e.text,position:this.pos(e),size:this.size(e),cssClasses:p(e),labels:[],properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.labels){const t=e.labels.map(this.transformElkLabel,this);i.labels.push(...t)}return i}transformElkEdge(e){var t,s;this.checkAndRememberId(e,this.edgeIds);const i={type:h(null===(s=null===(t=e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"edge"),id:e.id,sourceId:"",targetId:"",routingPoints:[],children:[],cssClasses:p(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};var o;if(null!=(o=e).source&&null!=o.target?(i.sourceId=e.source,i.targetId=e.target,e.sourcePoint&&i.routingPoints.push(e.sourcePoint),e.bendPoints&&i.routingPoints.push(...e.bendPoints),e.targetPoint&&i.routingPoints.push(e.targetPoint)):function(e){return null!=e.sources&&null!=e.targets}(e)&&(i.sourceId=e.sources[0],i.targetId=e.targets[0],e.sections&&e.sections.forEach((e=>{this.checkAndRememberId(e,this.sectionIds),i.routingPoints.push(e.startPoint),e.bendPoints&&i.routingPoints.push(...e.bendPoints),i.routingPoints.push(e.endPoint)}))),e.junctionPoints&&e.junctionPoints.forEach(((t,s)=>{const o={type:"junction",id:e.id+"_j"+s,position:t};i.children.push(o)})),e.labels){const t=e.labels.map(this.transformElkLabel,this);i.children.push(...t)}return i}pos(e){return{x:e.x||0,y:e.y||0}}size(e){return{width:e.width||0,height:e.height||0}}checkAndRememberId(e,t){if(null==e.id)throw Error("An element is missing an id.");if(t.has(e.id))throw Error("Duplicate id: "+e.id+".");t.add(e.id)}}let m=class extends l.LocalModelSource{async updateLayout(e,t,s){this.elkToSprotty=new g;let i=this.elkToSprotty.transform(e,t,s);await this.updateModel(i)}async getSelected(){let e=[];return(await this.getSelection()).forEach(((t,s)=>{e.push(t.id)})),e}element(){return document.getElementById(this.viewerOptions.baseDiv)}center(e=[],t=!0,s=!1){let i=new l.CenterAction(e,t,s);this.actionDispatcher.dispatch(i)}fit(e=[],t,s,i){let o=new l.FitToScreenAction(e,t,s,i);this.actionDispatcher.dispatch(o)}resize(e){let t=new l.InitializeCanvasBoundsAction(e);this.actionDispatcher.dispatch(t)}async getViewport(){const e=await this.actionDispatcher.request(l.GetViewportAction.create());return{scroll:e.viewport.scroll,zoom:e.viewport.zoom,canvasBounds:e.canvasBounds}}};m=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],m);var f=s(2388);const v={createElement:f.html};let y=class{render(e,t){const s=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;let i=(0,f.svg)("svg",{class:{"sprotty-graph":!0}},[(0,f.svg)("g",{transform:s},t.renderChildren(e)),(0,f.svg)("g",{class:{elksymbols:!0}},t.renderChildren(e.symbols))]);const o={transform:`scale(${e.zoom}) translateZ(0) translate(${-e.scroll.x}px,${-e.scroll.y}px)`};let n=v.createElement("div",{"class-sprotty-overlay":!0,style:o},t.renderWidgets());return v.createElement("div",{"class-sprotty-root":!0},i,n)}};y=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],y);var b=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r};const w={createElement:f.svg};function E(e){return`${e.x},${e.y}`}let S=class extends l.RectangularNodeView{render(e,t){if(!this.isSymbol(e)&&!this.isVisible(e,t))return;let s=this.renderMark(e,t);return this.isSymbol(e)||((0,l.setClass)(s,"elknode",!0),(0,l.setClass)(s,"mouseover",e.hoverFeedback),(0,l.setClass)(s,"selected",e.selected)),(0,l.setClass)(s,e.type,!0),w.createElement("g",null,s,w.createElement("g",{"class-elkchildren":!0},this.renderChildren(e,t)))}renderMark(e,t){return w.createElement("rect",{x:"0",y:"0",width:e.size.width,height:e.size.height})}renderChildren(e,t){return t.renderChildren(e)}isSymbol(e){var t;return 1==(null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.isSymbol)}};S=b([(0,d.injectable)()],S);let x=class extends S{renderMark(e,t){let s=e.size.width,i=e.size.height;const o={x:s,y:i/2},n={x:0,y:i/2},r={x:s/2,y:i},l=`${E({x:s/2,y:0})} ${E(o)} ${E(r)} ${E(n)}`;return w.createElement("polygon",{points:l})}};x=b([(0,d.injectable)()],x);let M=class extends S{renderMark(e,t){var s,i,o,n;let r=e.size.width/2,l=e.size.height/2,a=null===(i=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.x;null==a&&(a=r);let d=null===(n=null===(o=e.properties)||void 0===o?void 0:o.shape)||void 0===n?void 0:n.y;return null==d&&(d=l),w.createElement("ellipse",{rx:r,ry:l,cx:a,cy:d})}};M=b([(0,d.injectable)()],M);let k=class extends S{renderMark(e,t){var s,i;let o=e.size.width,n=e.size.height;return w.createElement("image",{width:o,height:n,href:null===(i=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use})}};k=b([(0,d.injectable)()],k);let C=class extends S{renderMark(e,t){var s,i;let o=Number(null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use)||15,n=e.size.width,r=e.size.height;const l=[{x:0,y:0},{x:n-o,y:0},{x:n,y:o},{x:n,y:r},{x:0,y:r}].map(E).join(" ");return w.createElement("polygon",{points:l})}};C=b([(0,d.injectable)()],C);let P=class extends S{renderMark(e,t){var s,i;let o=null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use;return w.createElement("path",{d:o})}};P=b([(0,d.injectable)()],P);let R=class extends S{renderMark(e,t){var s,i;let o=null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use,n=t.hrefID(o),r=w.createElement("use",{href:"#"+n,width:e.size.width,height:e.size.height});return(0,l.setClass)(r,o,!0),r}};R=b([(0,d.injectable)()],R);let j=class extends S{renderMark(e,t){var s,i,o,n,r,l;let a=(null===(i=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.x)||0,d=(null===(n=null===(o=e.properties)||void 0===o?void 0:o.shape)||void 0===n?void 0:n.y)||0;return w.createElement("g",{props:{innerHTML:null===(l=null===(r=null==e?void 0:e.properties)||void 0===r?void 0:r.shape)||void 0===l?void 0:l.use},transform:`translate(${a} ${d})`},[])}};j=b([(0,d.injectable)()],j);let O=class extends S{renderMark(e,t){if(e.parent.type==e.type){const t=e.parent.size;return w.createElement("rect",{x:"0",y:"0",width:t.width,height:e.size.height})}return super.renderMark(e,t)}};O=b([(0,d.injectable)()],O);let D=class extends S{renderMark(e,t){var s,i;let o=(0,f.html)("div",{props:{innerHTML:null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use}},[]);return w.createElement("foreignObject",{requiredFeatures:"http://www.w3.org/TR/SVG11/feature#Extensibility",height:e.size.height,width:e.size.width,x:0,y:0},o)}};D=b([(0,d.injectable)()],D);let _=class extends S{render(e,t){if(!this.isSymbol(e)&&!this.isVisible(e,t))return;let s=this.renderMark(e,t);return this.isSymbol(e)||((0,l.setClass)(s,"elknode",!0),(0,l.setClass)(s,"mouseover",e.hoverFeedback),(0,l.setClass)(s,"selected",e.selected)),(0,l.setClass)(s,e.type,!0),(0,f.svg)("g",{hook:{insert:s=>t.overlayContent(s,e,!0),destroy:s=>t.overlayContent(s,e,!1),update:(s,i)=>t.overlayContent(i,e,this.isVisible(e,t))}},[s,w.createElement("g",{"class-elkchildren":!0},this.renderChildren(e,t))])}};_=b([(0,d.injectable)()],_);let I=class extends l.RectangularNodeView{render(e,t){var s,i;let o,n=null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use,r=t.hrefID(n);return r?(o=w.createElement("use",{"class-elkport":!0,width:e.size.width,height:e.size.height,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,href:"#"+r}),(0,l.setClass)(o,n,!0)):o=w.createElement("rect",{"class-elkport":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,x:"0",y:"0",width:e.size.width,height:e.size.height}),w.createElement("g",null,o,t.renderChildren(e))}};I=b([(0,d.injectable)()],I);let F=class extends l.ShapeView{render(e,t){var s,i,o,n,r;if(!this.isVisible(e,t))return;let a,d=null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use,c=t.hrefID(d);if(c?(a=w.createElement("use",{"class-elklabel":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,href:"#"+c,width:e.size.width,height:e.size.height}),(0,l.setClass)(a,d,!0)):a=w.createElement("text",{"class-elklabel":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},e.text),null===(o=e.labels)||void 0===o?void 0:o.length){let s=e.labels[0],i=null===(r=null===(n=null==s?void 0:s.properties)||void 0===n?void 0:n.shape)||void 0===r?void 0:r.use,o=t.hrefID(i),l=e.size.height,d=this.dimension(s),c=this.dimension(e),u={x:0+s.position.x,y:(l-d.height)/2+s.position.x},h=(null==s?void 0:s.layoutOptions)||{},p=Number(h["org.eclipse.elk.spacing.labelLabel"])||0,g={x:d.width+p,y:(l-c.height)/2};a=w.createElement("g",null,w.createElement("use",{transform:`translate(${u.x} ${u.y})`,"class-elklabel":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,href:"#"+o,width:s.size.width,height:s.size.height}),w.createElement("g",{transform:`translate(${g.x} ${g.y})`},a))}return a}dimension(e){var t,s,i,o;return{width:(null===(s=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.width)||e.size.width,height:(null===(o=null===(i=null==e?void 0:e.properties)||void 0===i?void 0:i.shape)||void 0===o?void 0:o.height)||e.size.height}}isVisible(e,t){if(!super.isVisible(e,t))return!1;let s,i=e.root.zoom;return s=!e.size.height||i*e.size.height>3,s}};F=b([(0,d.injectable)()],F);var T=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r};const z={createElement:f.svg};let L=class extends l.CircularNodeView{render(e,t){const s=this.getRadius(e);return z.createElement("g",null,z.createElement("circle",{"class-elkjunction":!0,r:s}))}getRadius(e){return 2}};L=T([(0,d.injectable)()],L);let A=class extends l.PolylineEdgeView{render(e,t){const s=this.edgeRouterRegistry.get(e.routerKind).route(e);if(0===s.length)return this.renderDanglingEdge("Cannot compute route",e,t);if(!this.isVisible(e,s,t)){if(0===e.children.length)return;return z.createElement("g",null,t.renderChildren(e,{route:s}))}return z.createElement("g",{"class-elkedge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,s,t),this.renderAdditionals(e,s,t),t.renderChildren(e,{route:s}))}renderLine(e,t,s){var i,o,n,r;const a=t[1],d=t[0];let c=(0,l.angleOfPoint)({x:a.x-d.x,y:a.y-d.y});const u=t[t.length-2],h=t[t.length-1];let p=(0,l.angleOfPoint)({x:u.x-h.x,y:u.y-h.y}),g=this.getPathOffset(null===(o=null===(i=null==e?void 0:e.properties)||void 0===i?void 0:i.shape)||void 0===o?void 0:o.start,s,c),m=this.getPathOffset(null===(r=null===(n=null==e?void 0:e.properties)||void 0===n?void 0:n.shape)||void 0===r?void 0:r.end,s,p);const f=t[0];let v=`M ${f.x-g.x},${f.y-g.y}`;for(let e=1;e<t.length-1;e++){const s=t[e];v+=` L ${s.x},${s.y}`}const y=t[t.length-1];return v+=` L ${y.x-m.x}, ${y.y-m.y}`,z.createElement("path",{d:v})}getAnchorOffset(e,t,s){let i=t.getConnector(e);if(null==i?void 0:i.symbol_offset){const e=i.symbol_offset;return{x:e.x*Math.cos(s)-e.y*Math.sin(s),y:e.x*Math.sin(s)+e.y*Math.cos(s)}}return{x:0,y:0}}getPathOffset(e,t,s){let i=t.getConnector(e);if(null==i?void 0:i.path_offset){const e=i.path_offset;return{x:e.x*Math.cos(s)-e.y*Math.sin(s),y:e.x*Math.sin(s)+e.y*Math.cos(s)}}return{x:0,y:0}}renderAdditionals(e,t,s){var i,o,n,r;let a,d,c,u=[],h=null===(o=null===(i=null==e?void 0:e.properties)||void 0===i?void 0:i.shape)||void 0===o?void 0:o.start,p=null===(r=null===(n=null==e?void 0:e.properties)||void 0===n?void 0:n.shape)||void 0===r?void 0:r.end;if(h){const e=t[1],i=t[0];let o=(0,l.angleOfPoint)({x:e.x-i.x,y:e.y-i.y});d=this.getAnchorOffset(h,s,o);let n=i.x-d.x,r=i.y-d.y;a=s.hrefID(h),c=z.createElement("use",{href:"#"+a,"class-elkedge-start":!0,"class-elkarrow":!0,transform:`rotate(${(0,l.toDegrees)(o)} ${n} ${r}) translate(${n} ${r})`}),(0,l.setClass)(c,h,!0),u.push(c)}if(p){const e=t[t.length-2],i=t[t.length-1];let o=(0,l.angleOfPoint)({x:e.x-i.x,y:e.y-i.y});d=this.getAnchorOffset(p,s,o);let n=i.x-d.x,r=i.y-d.y;a=s.hrefID(p),c=z.createElement("use",{href:"#"+a,"class-elkedge-end":!0,"class-elkarrow":!0,transform:`rotate(${(0,l.toDegrees)(o)} ${n} ${r}) translate(${n} ${r})`}),(0,l.setClass)(c,p,!0),u.push(c)}return u}};A=T([(0,d.injectable)()],A);let $=class{render(e,t){var s,i;let o=(null===(s=e.position)||void 0===s?void 0:s.x)||0,n=(null===(i=e.position)||void 0===i?void 0:i.y)||0,r=e.size.width||0,l=e.size.height||0,a={class:{[e.id]:!0,elksymbol:!0}};return r&&l&&(a.viewBox=`${o} ${n} ${r} ${l}`),(0,f.svg)("symbol",a,t.renderChildren(e))}};$=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],$);class V extends l.RectangularNode{hasFeature(e){return e!==l.moveFeature&&super.hasFeature(e)}}class N extends l.RectangularPort{hasFeature(e){return e!==l.moveFeature&&super.hasFeature(e)}}class B extends l.SEdge{hasFeature(e){return e!==l.editFeature&&super.hasFeature(e)}}class K extends l.SNode{hasFeature(e){return e!==l.moveFeature&&e!==l.selectFeature&&e!==l.hoverFeedbackFeature&&super.hasFeature(e)}}class Y extends l.SLabel{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1}hasFeature(e){var t;return e!==l.selectFeature&&e!==l.hoverFeedbackFeature?super.hasFeature(e):!0===(null===(t=this.properties)||void 0===t?void 0:t.selectable)||void 0}}Y.DEFAULT_FEATURES=[l.selectFeature,l.hoverFeedbackFeature,l.boundsFeature,l.alignFeature,l.layoutableChildFeature,l.edgeLayoutFeature,l.fadeFeature];class U extends l.SNode{hasFeature(e){return e!==l.moveFeature&&super.hasFeature(e)}}var H=s(6510);class W extends l.ModelRenderer{constructor(e,t,s,i){super(e,t,s),this.viewRegistry=e,this.targetKind=t,this.source=i,this.widgets=new Map}renderWidgets(e){let t=[];for(let s in this.widgets){let i=this.widgets[s],o=this.widgetContainer(i,e);void 0!==o&&(this.decorate(o,i.node),t.push(o))}return t}widgetContainer(e,t){if(!e.visible)return;let s=e.node.bounds,i=function(e){var t,s;let i=0,o=0;for(;void 0!==e;)i+=(null===(t=e.bounds)||void 0===t?void 0:t.x)||0,o+=(null===(s=e.bounds)||void 0===s?void 0:s.y)||0,e=null==e?void 0:e.parent;return{x:i,y:o}}(e.node),o={transform:`translate(${i.x}px, ${i.y}px)`,width:`${s.width}px`,height:`${s.height}px`,background:"#9dd8d857"},n={};return e.html&&(n={innerHTML:e.html}),(0,f.html)("div",{key:e.node.id,class:{elkcontainer:!0},style:o,props:n,hook:{insert:t=>this.renderContent(t,e)}},[])}async renderContent(e,t,s){if("widget"==(0,l.getSubType)(t.node)){let s=t.widget,i=await this.source.widget_manager.create_view(s,{});H.Widget.attach(i.pWidget,e.elm)}}async overlayContent(e,t,s){var i,o;let n,r,a=null===(o=null===(i=t.properties)||void 0===i?void 0:i.shape)||void 0===o?void 0:o.use;"widget"==(0,l.getSubType)(t)?a&&(n=await this.source.widget_manager.get_model(a),r=void 0):(n=void 0,r=a),this.widgets[t.id]={vnode:e,node:t,widget:n,visible:s,html:r}}getConnector(e){var t;return null===(t=this.source.elkToSprotty)||void 0===t?void 0:t.connectors[e]}hrefID(e){if(e)return this.source.elkToSprotty.symbolsIds[e]}}class G extends l.SModelFactory{initializeRoot(e,t){var s;return(null===(s=e=super.initializeRoot(e,t))||void 0===s?void 0:s.symbols)&&(e.symbols.children=t.symbols.children.map((t=>this.createElement(t,e)))),e}}const q={IFeedbackActionDispatcher:Symbol.for("IFeedbackActionDispatcher"),IToolFactory:Symbol.for("Factory<Tool>"),IEditConfigProvider:Symbol.for("IEditConfigProvider"),RequestResponseSupport:Symbol.for("RequestResponseSupport"),SelectionService:Symbol.for("SelectionService"),SelectionListener:Symbol.for("SelectionListener"),SModelRootListener:Symbol.for("SModelRootListener"),MouseTool:Symbol.for("MouseTool"),ViewerOptions:Symbol.for("ViewerOptions")};class X extends l.Command{constructor(){super(...arguments),this.priority=0}undo(e){return e.root}redo(e){return e.root}}var Z;!function(e){e.DEFAULT="default-mode",e.OVERLAP_FORBIDDEN="overlap-forbidden-mode",e.NODE_CREATION="node-creation-mode",e.EDGE_CREATION_SOURCE="edge-creation-select-source-mode",e.EDGE_CREATION_TARGET="edge-creation-select-target-mode",e.EDGE_RECONNECT="edge-reconnect-select-target-mode",e.OPERATION_NOT_ALLOWED="edge-modification-not-allowed-mode",e.ELEMENT_DELETION="element-deletion-mode",e.MOUSEOVER="mouseover",e.SELECTED="selected"}(Z||(Z={}));let J=class extends X{constructor(e){super(),this.action=e}execute(e){return function(e,t){if(null!=e.cssClasses&&0!==e.cssClasses.length)for(const s of t)-1!==e.cssClasses.indexOf(s)&&e.cssClasses.splice(e.cssClasses.indexOf(s),1)}(this.action.target,Object.values(Z)),this.action.cssClass&&function(e,t){null==e.cssClasses&&(e.cssClasses=[]);for(const s of t)e.cssClasses.indexOf(s)<0&&e.cssClasses.push(s)}(this.action.target,[this.action.cssClass]),e.root}};var Q,ee;J.KIND="applyCursorCssFeedback",J=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)(),(Q=0,ee=(0,d.inject)(l.TYPES.Action),function(e,t){ee(e,t,Q)}),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[class{constructor(e,t){this.target=e,this.cssClass=t,this.kind=J.KIND}}])],J);var te=function(e,t){return function(s,i){t(s,i,e)}};let se=class{constructor(e,t){this.actionDispatcher=e,this.logger=t,this.feedbackEmitters=new Map}registerFeedback(e,t){this.feedbackEmitters.set(e,t),this.dispatch(t,e)}deregisterFeedback(e,t){this.feedbackEmitters.delete(e),this.dispatch(t,e)}dispatch(e,t){this.actionDispatcher().then((t=>t.dispatchAll(e))).then((()=>this.logger.info(this,`Dispatched feedback actions for ${t}`))).catch((e=>this.logger.error(this,"Failed to dispatch feedback actions",e)))}getRegisteredFeedback(){const e=[];return this.feedbackEmitters.forEach(((t,s)=>e.push(...t))),e}getRegisteredFeedbackEmitters(e){const t=[];return this.feedbackEmitters.forEach(((s,i)=>{s.find((t=>t===e))&&t.push(i)})),t}};se=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)(),te(0,(0,d.inject)(l.TYPES.IActionDispatcherProvider)),te(1,(0,d.inject)(l.TYPES.ILogger)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Function,Object])],se);const ie=new d.ContainerModule(((e,t,s)=>{e(q.IFeedbackActionDispatcher).to(se).inSingletonScope(),(0,l.configureCommand)({bind:e,isBound:s},J),(0,l.configureCommand)({bind:e,isBound:s},l.MoveCommand),(0,l.configureCommand)({bind:e,isBound:s},l.SelectCommand),(0,l.configureCommand)({bind:e,isBound:s},l.SelectAllCommand),(0,l.configureCommand)({bind:e,isBound:s},l.GetSelectionCommand),e(l.TYPES.IVNodePostprocessor).to(l.LocationPostprocessor),e(l.TYPES.HiddenVNodePostprocessor).to(l.LocationPostprocessor)}));var oe=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},re=function(e,t){return function(s,i){t(s,i,e)}};let le=class extends l.ScrollMouseListener{constructor(e){super(),this.model_source=e}mouseDown(e,t){if(null==(0,l.findParentByFeature)(e,l.isMoveable)&&!(e instanceof l.SRoutingHandle))if("node:widget"==e.type)this.lastScrollPosition=void 0;else{const s=(0,l.findParentByFeature)(e,l.isViewport);this.lastScrollPosition=s?{x:t.pageX,y:t.pageY}:void 0}return[]}mouseMove(e,t){if(0===t.buttons)this.mouseUp(e,t);else if(this.lastScrollPosition){const s=(0,l.findParentByFeature)(e,l.isViewport);if(s){const e=(t.pageX-this.lastScrollPosition.x)/s.zoom,i=(t.pageY-this.lastScrollPosition.y)/s.zoom,o={scroll:{x:s.scroll.x-e,y:s.scroll.y-i},zoom:s.zoom};return this.lastScrollPosition={x:t.pageX,y:t.pageY},[new l.SetViewportAction(s.id,o,!1)]}}return[]}};le=oe([re(0,(0,d.inject)(l.TYPES.ModelSource)),ne("design:paramtypes",[m])],le);let ae=class extends l.ZoomMouseListener{constructor(e){super(),this.model_source=e}getViewportOffset(e,t){const s=this.model_source.element().getBoundingClientRect();return{x:t.clientX-s.left,y:t.clientY-s.top}}};ae=oe([re(0,(0,d.inject)(l.TYPES.ModelSource)),ne("design:paramtypes",[m])],ae);const de=new d.ContainerModule(((e,t,s)=>{(0,l.configureCommand)({bind:e,isBound:s},l.CenterCommand),(0,l.configureCommand)({bind:e,isBound:s},l.FitToScreenCommand),(0,l.configureCommand)({bind:e,isBound:s},l.SetViewportCommand),(0,l.configureCommand)({bind:e,isBound:s},l.GetViewportCommand),e(l.TYPES.KeyListener).to(l.CenterKeyboardListener),e(l.TYPES.MouseListener).to(le),e(l.TYPES.MouseListener).to(ae)}));class ce extends l.SvgExporter{isExported(e){return null!=e.href&&(e.href.endsWith("diagram.css")||e.href.endsWith("sprotty.css"))}}var ue=s(9140);class he extends l.MouseListener{constructor(){super(...arguments),this.isMouseDown=!1,this.isMouseDrag=!1}mouseDown(e,t){return this.isMouseDown=!0,[]}mouseMove(e,t){return this.isMouseDown&&(this.isMouseDrag=!0),[]}mouseUp(e,t){return this.isMouseDown=!1,this.isMouseDrag?(this.isMouseDrag=!1,this.draggingMouseUp(e,t)):this.nonDraggingMouseUp(e,t)}nonDraggingMouseUp(e,t){return[]}draggingMouseUp(e,t){return[]}}class pe extends he{constructor(e,t){super(),this.elementTypeId=e,this.tool=t}mouseOver(e,t){return[new l.HoverFeedbackAction(e.id,!0)]}mouseOut(e,t){return[new l.HoverFeedbackAction(e.id,!1)]}}let ge=class{constructor(){this.elementTypeId="unknown",this.operationKind="generic"}get id(){return`tool_${this.operationKind}_${this.elementTypeId}`}enable(){}disable(){}dispatchFeedback(e){}};function me(e){return e.id}ge=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],ge);var fe=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},ve=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ye=function(e,t){return function(s,i){t(s,i,e)}};let be=class extends ge{constructor(e,t){super(),this.mouseTool=e,this.feedbackDispatcher=t,this.elementTypeId="unknown",this.operationKind=l.SelectAction.KIND}enable(){this.selectionToolMouseListener=new we(this.elementTypeId,this),this.mouseTool.register(this.selectionToolMouseListener)}disable(){this.mouseTool.deregister(this.selectionToolMouseListener)}};be=fe([(0,d.injectable)(),ye(0,(0,d.inject)(l.MouseTool)),ye(1,(0,d.inject)(q.IFeedbackActionDispatcher)),ve("design:paramtypes",[Object,Object])],be);let we=class extends pe{constructor(e,t){super(e,t),this.elementTypeId=e,this.tool=t}nonDraggingMouseUp(e,t){let s=[],i=[];if(0===t.button){const o=(0,l.findParentByFeature)(e,l.isSelectable);(null!=o||e instanceof l.SModelRoot)&&((0,l.isCtrlOrCmd)(t)||(i=(0,ue.toArray)(e.root.index.all().filter((e=>(0,l.isSelectable)(e)&&e.selected&&!(o instanceof l.SRoutingHandle&&e===o.parent))))),null!=o&&(o.selected?(0,l.isCtrlOrCmd)(t)&&(i=[o]):s=[o]))}return[new l.SelectAction(s.map(me),i.map(me))]}decorate(e,t){const s=(0,l.findParentByFeature)(t,l.isSelectable);return null!=s&&(0,l.setClass)(e,"selected",s.selected),e}};we=fe([(0,d.injectable)(),ve("design:paramtypes",[String,be])],we);var Ee=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},Se=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},xe=function(e,t){return function(s,i){t(s,i,e)}};class Me{constructor(e=[],t=[]){this.expandElementsIDs=e,this.contractElementsIDs=t,this.kind=l.SelectAction.KIND}}Me.KIND="elementExpand";let ke=class extends ge{constructor(e,t){super(),this.mouseTool=e,this.feedbackDispatcher=t,this.elementTypeId="unknown",this.operationKind=Me.KIND}enable(){this.expansionToolMouseListener=new Ce(this.elementTypeId,this),this.mouseTool.register(this.expansionToolMouseListener)}disable(){this.mouseTool.deregister(this.expansionToolMouseListener)}dispatchFeedback(e){this.feedbackDispatcher.registerFeedback(this,e)}};ke=Ee([(0,d.injectable)(),xe(0,(0,d.inject)(l.MouseTool)),xe(1,(0,d.inject)(q.IFeedbackActionDispatcher)),Se("design:paramtypes",[Object,Object])],ke);let Ce=class extends he{constructor(e,t){super(),this.elementTypeId=e,this.tool=t}wheel(e,t){return[]}decorate(e,t){const s=(0,l.findParentByFeature)(t,l.isSelectable);return null!=s&&(0,l.setClass)(e,"selected",s.selected),e}};Ce=Ee([(0,d.injectable)(),Se("design:paramtypes",[String,ke])],Ce);var Pe,Re=s(1797);class je extends r.DOMWidgetModel{constructor(){super(...arguments),this.layoutUpdated=new n.Signal(this),this.diagramUpdated=new n.Signal(this)}defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:je.model_name,_model_module_version:a.q4,_view_module:a.A1,_view_name:Oe.view_name,_view_module_version:a.q4,symbols:{},source:null})}initialize(e,t){super.initialize(e,t)}}je.model_name="ELKViewerModel",je.serializers=Object.assign(Object.assign({},r.DOMWidgetModel.serializers),{source:{deserialize:r.unpack_models},selection:{deserialize:r.unpack_models},hover:{deserialize:r.unpack_models},painter:{deserialize:r.unpack_models},zoom:{deserialize:r.unpack_models},pan:{deserialize:r.unpack_models}});class Oe extends r.DOMWidgetView{constructor(){super(...arguments),this.was_shown=new Re.PromiseDelegate,this.wait_for_visible=(e=!1)=>{this.pWidget.isVisible?setTimeout(this.wait_for_visible,e?0:300):this.was_shown.resolve()},this.resize=(e=-1,t=-1)=>{if(-1===e||-1===t){const s=this.el.getBoundingClientRect();e=s.width,t=s.height}this.source.resize({width:e,height:t,x:0,y:0})}}initialize(e){super.initialize(e),this.pWidget.addClass(a.gJ.widget_class),this.on("change:source",this.on_source_changed,this),this.on_source_changed()}async on_source_changed(){let e=this.model.get("source");e&&(e.on("change:value",this.diagramLayout,this),this.diagramLayout())}async render(){const e=this.el,t=document.createElement("div");this.div_id=t.id=Pe.next_id(),e.appendChild(t),this.initSprotty().catch(console.warn),this.wait_for_visible(!0)}async initSprotty(){await this.was_shown.promise;const e=((e,t)=>{const s=new d.ContainerModule(((t,s,i,o)=>{t(l.TYPES.ModelSource).to(m).inSingletonScope(),o(l.TYPES.ILogger).to(l.ConsoleLogger).inSingletonScope(),o(l.TYPES.LogLevel).toConstantValue(l.LogLevel.warn),o(l.TYPES.SvgExporter).to(ce).inSingletonScope();const n={bind:t,unbind:s,isBound:i,rebind:o};(0,l.configureModelElement)(n,"graph",l.SGraph,y),(0,l.configureModelElement)(n,"node",V,S),(0,l.configureModelElement)(n,"node:use",V,R),(0,l.configureModelElement)(n,"node:diamond",V,x),(0,l.configureModelElement)(n,"node:round",V,M),(0,l.configureModelElement)(n,"node:image",V,k),(0,l.configureModelElement)(n,"node:comment",V,C),(0,l.configureModelElement)(n,"node:path",V,P),(0,l.configureModelElement)(n,"node:svg",V,j),(0,l.configureModelElement)(n,"node:html",V,_),(0,l.configureModelElement)(n,"node:widget",V,_),(0,l.configureModelElement)(n,"node:compartment",V,O),(0,l.configureModelElement)(n,"node:foreignobject",V,D),(0,l.configureModelElement)(n,"port",N,I),(0,l.configureModelElement)(n,"edge",B,A),(0,l.configureModelElement)(n,"label",Y,F),(0,l.configureModelElement)(n,"label:icon",Y,F),(0,l.configureModelElement)(n,"junction",K,L),(0,l.configureViewerOptions)(n,{needsClientLayout:!1,baseDiv:e}),(0,l.configureCommand)(n,l.HoverFeedbackCommand),(0,l.configureModelElement)(n,"symbol",U,$),o(l.TYPES.ModelRendererFactory).toFactory((e=>(t,s)=>{const i=e.container.get(l.TYPES.ViewRegistry),o=e.container.get(l.TYPES.ModelSource);return new W(i,t,s,o)})),o(l.TYPES.IModelFactory).to(G).inSingletonScope()})),i=new d.Container;return i.load(l.defaultModule,l.boundsModule,l.moveModule,l.fadeModule,u,l.undoRedoModule,de,l.routingModule,l.exportModule,l.modelSourceModule,l.edgeEditModule,l.labelEditModule,ie,s),i})(this.div_id);this.container=e,this.source=e.get(l.TYPES.ModelSource),this.source.widget_manager=this.model.widget_manager,this.elementRegistry=e.get(l.TYPES.SModelRegistry),this.toolManager=e.get(l.TYPES.IToolManager),this.registry=e.get(l.ActionHandlerRegistry),this.actionDispatcher=e.get(l.TYPES.IActionDispatcher),this.feedbackDispatcher=e.get(q.IFeedbackActionDispatcher),this.model.on("change:selection",this.updateSelectedTool,this),this.model.on("change:hover",this.updateHoverTool,this),this.model.on("change:interaction",this.interaction_mode_changed,this),this.model.on("msg:custom",this.handleMessage,this),this.model.on("change:symbols",this.diagramLayout,this),this.updateSelectedTool(),this.updateHoverTool(),this.touch(),this.registry.register(l.SelectAction.KIND,this),this.registry.register(l.SelectionResult.KIND,this),this.registry.register(l.HoverFeedbackAction.KIND,this),this.toolManager.registerDefaultTools(e.resolve(be),e.resolve(ke)),this.toolManager.enableDefaultTools(),this.diagramLayout().catch((e=>console.warn("ELK Failed initial view render",e)))}processPhosphorMessage(e){switch(super.processPhosphorMessage(e),e.type){case"resize":const t=e;let{width:s,height:i}=t;this.resize(s,i);break;case"after-show":this.resize()}}handle(e){switch(e.kind){case l.SelectAction.KIND:this.source.getSelected().then((e=>{let t=this.model.get("selection");null!=t&&(t.set("ids",e),t.save_changes(),this.model.diagramUpdated.emit(void 0))}));break;case l.SelectionResult.KIND:break;case l.HoverFeedbackAction.KIND:let t=e;if(t.mouseIsOver){let e=this.model.get("hover");null!=e&&(e.set("ids",t.mouseoverElement),e.save_changes(),this.model.diagramUpdated.emit(void 0))}}}updateSelectedTool(){let e=this.model.get("selection");null!=e&&e.on("change:ids",this.updateSelected,this)}async updateSelected(){let e=this.model.get("selection");if(null!=e){let t=e.get("ids"),s=e.previous("ids"),i=o()(s,t),n=o()(t,s);await this.actionDispatcher.dispatch(new l.SelectAction(n,i)),this.model.diagramUpdated.emit(void 0)}}updateHoverTool(){let e=this.model.get("hover");null!=e&&e.on("change:ids",this.updateHover,this)}async updateHover(){let e=this.model.get("hover");if(null!=e){let t=e.get("ids"),s=e.previous("ids");await this.actionDispatcher.dispatchAll([new l.HoverFeedbackAction(t,!0),new l.HoverFeedbackAction(s,!1)]),this.model.diagramUpdated.emit(void 0)}}async interaction_mode_changed(){}async diagramLayout(){var e;let t=null===(e=this.model.get("source"))||void 0===e?void 0:e.get("value"),s=this.model.get("symbols");if(null==t||null==s||null==this.source)return null;await this.source.updateLayout(t,s,this.div_id),this.model.layoutUpdated.emit(),this.model.diagramUpdated.emit()}normalizeElementIds(e){let t=[];return null!=e&&(t=Array.isArray(e)?e:[e]),t}handleMessage(e){switch(e.action){case"center":this.source.center(this.normalizeElementIds(e.model_id),e.animate,e.retain_zoom);break;case"fit":this.source.fit(this.normalizeElementIds(e.model_id),null==e.padding?0:e.padding,null==e.max_zoom?1/0:e.max_zoom,null==e.animate||e.animate);break;default:console.warn("ELK unhandled message",e)}}}Oe.view_name="ELKViewerView",function(e){let t=0;e.next_id=function(){return"sprotty_"+t++}}(Pe||(Pe={}))}}]);