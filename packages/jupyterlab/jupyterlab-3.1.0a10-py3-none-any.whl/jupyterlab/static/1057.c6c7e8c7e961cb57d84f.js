(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[1057,3373],{1057:(t,e,s)=>{"use strict";s.d(e,{GL:()=>r,Ag:()=>h,xq:()=>u,oy:()=>p});var n=s(19038);var a=s(64485);var c=s(20817);var i=s(14247);var l=s(58290);var o=s(97027);const d=3e4;class r extends l.y{constructor(t){super();this.doc=t;this.clientID=t.clientID;this.states=new Map;this.meta=new Map;this._checkInterval=setInterval((()=>{const t=c.ZG();if(this.getLocalState()!==null&&d/2<=t-this.meta.get(this.clientID).lastUpdated){this.setLocalState(this.getLocalState())}const e=[];this.meta.forEach(((s,n)=>{if(n!==this.clientID&&d<=t-s.lastUpdated&&this.states.has(n)){e.push(n)}}));if(e.length>0){h(this,e,"timeout")}}),i.GW(d/10));t.on("destroy",(()=>{this.destroy()}));this.setLocalState({})}destroy(){this.emit("destroy",[this]);this.setLocalState(null);super.destroy();clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const e=this.clientID;const s=this.meta.get(e);const n=s===undefined?0:s.clock+1;const a=this.states.get(e);if(t===null){this.states.delete(e)}else{this.states.set(e,t)}this.meta.set(e,{clock:n,lastUpdated:c.ZG()});const i=[];const l=[];const d=[];const r=[];if(t===null){r.push(e)}else if(a==null){if(t!=null){i.push(e)}}else{l.push(e);if(!o.Hi(a,t)){d.push(e)}}if(i.length>0||d.length>0||r.length>0){this.emit("change",[{added:i,updated:d,removed:r},"local"])}this.emit("update",[{added:i,updated:l,removed:r},"local"])}setLocalStateField(t,e){const s=this.getLocalState();if(s!==null){this.setLocalState({...s,[t]:e})}}getStates(){return this.states}}const h=(t,e,s)=>{const n=[];for(let a=0;a<e.length;a++){const s=e[a];if(t.states.has(s)){t.states.delete(s);if(s===t.clientID){const e=t.meta.get(s);t.meta.set(s,{clock:e.clock+1,lastUpdated:c.ZG()})}n.push(s)}}if(n.length>0){t.emit("change",[{added:[],updated:[],removed:n},s]);t.emit("update",[{added:[],updated:[],removed:n},s])}};const u=(t,e,s=t.states)=>{const a=e.length;const c=n.Mf();n.uE(c,a);for(let i=0;i<a;i++){const a=e[i];const l=s.get(a)||null;const o=t.meta.get(a).clock;n.uE(c,a);n.uE(c,o);n.uw(c,JSON.stringify(l))}return n._f(c)};const g=(t,e)=>{const s=decoding.createDecoder(t);const n=encoding.createEncoder();const a=decoding.readVarUint(s);encoding.writeVarUint(n,a);for(let c=0;c<a;c++){const t=decoding.readVarUint(s);const a=decoding.readVarUint(s);const c=JSON.parse(decoding.readVarString(s));const i=e(c);encoding.writeVarUint(n,t);encoding.writeVarUint(n,a);encoding.writeVarString(n,JSON.stringify(i))}return encoding.toUint8Array(n)};const p=(t,e,s)=>{const n=a.l1(e);const i=c.ZG();const l=[];const d=[];const r=[];const h=[];const u=a.yg(n);for(let c=0;c<u;c++){const e=a.yg(n);let s=a.yg(n);const c=JSON.parse(a.kf(n));const u=t.meta.get(e);const g=t.states.get(e);const p=u===undefined?0:u.clock;if(p<s||p===s&&c===null&&t.states.has(e)){if(c===null){if(e===t.clientID&&t.getLocalState()!=null){s++}else{t.states.delete(e)}}else{t.states.set(e,c)}t.meta.set(e,{clock:s,lastUpdated:i});if(u===undefined&&c!==null){l.push(e)}else if(u!==undefined&&c===null){h.push(e)}else if(c!==null){if(!o.Hi(c,g)){r.push(e)}d.push(e)}}}if(l.length>0||r.length>0||h.length>0){t.emit("change",[{added:l,updated:r,removed:h},s])}if(l.length>0||d.length>0||h.length>0){t.emit("update",[{added:l,updated:d,removed:h},s])}}}}]);