(self.webpackChunkcatboost_widget=self.webpackChunkcatboost_widget||[]).push([[138],{306:t=>{"use strict";t.exports={version:"1.0.0"}},294:()=>{function t(){}t.prototype.init=function(){this.charts={},this.traces={},this.hovertextParameters=[],this.chartsToRedraw={},this.lastIndexes={},this.smoothness=-1,this.layoutDisabled={series:{},traces:{}},this.clickMode=!1,this.logarithmMode="linear",this.lastSmooth=0,this.layout=null,this.activeTab="",this.meta={},this.timeLeft={},this.hasCVMode=!1,this.stddevEnabled=!1,this.colors=["#68E256","#56AEE2","#CF56E2","#E28956","#56E289","#5668E2","#E256AE","#E2CF56","#56E2CF","#8A56E2","#E25668","#AEE256"],this.colorsByPath={},this.colorIndex=0,this.lossFuncs={},this.isCVinited=!1},t.prototype.loadStyles=function(t,e,a){$('link[catboost="1"]').remove();var s,o,r=document.getElementsByTagName("head")[0],i=document.createElement("link");i.setAttribute("href",t),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("catboost","1"),"sheet"in i?(s="sheet",o="cssRules"):(s="styleSheet",o="rules");var c=setInterval((function(){try{i[s]&&i[s][o].length&&(clearInterval(c),clearTimeout(n),e.call(a||window,!0,i))}catch(t){}}),50),n=setTimeout((function(){clearInterval(c),clearTimeout(n),r.removeChild(i),e.call(a||window,!1,i)}),15e3);return r.appendChild(i),i},t.prototype.resizeCharts=function(){$(".catboost-graph__charts",this.layout).css({width:$(".catboost-graph").width()}),this.plotly.Plots.resize(this.traces[this.activeTab].parent)},t.prototype.addMeta=function(t,e){this.meta[t]=e},t.prototype.addLayout=function(t){if(!this.layout){var e="";this.hasCVMode&&(e='<div><input type="checkbox" class="catboost-panel__control_checkbox" id="catboost-control2-cvstddev'+this.index+'"'+(this.stddevEnabled?' checked="checked"':"")+'></input><label for="catboost-control2-cvstddev'+this.index+'" class="catboost-panel__controls2_label catboost-panel__controls2_label-long">Standard Deviation</label></div>'),this.layout=$('<div class="catboost"><div class="catboost-panel"><div class="catboost-panel__controls"><input type="checkbox" class="catboost-panel__controls_checkbox" id="catboost-control-learn'+this.index+'" '+(this.layoutDisabled.learn?"":' checked="checked"')+'></input><label for="catboost-control-learn'+this.index+'" class="catboost-panel__controls_label"><div class="catboost-panel__serie_learn_pic" style="border-color:#999"></div>Learn</label><input type="checkbox" class="catboost-panel__controls_checkbox" id="catboost-control-test'+this.index+'" '+(this.layoutDisabled.test?"":' checked="checked"')+'></input><label for="catboost-control-test'+this.index+'" class="catboost-panel__controls_label"><div class="catboost-panel__serie_test_pic" style="border-color:#999"></div>Eval</label></div><div class="catboost-panel__series '+(this.layoutDisabled.learn?" catboost-panel__series_learn_disabled":"")+'"></div><div class="catboost-panel__controls2"><input type="checkbox" class="catboost-panel__control_checkbox" id="catboost-control2-clickmode'+this.index+'"></input><label for="catboost-control2-clickmode'+this.index+'" class="catboost-panel__controls2_label">Click Mode</label><input type="checkbox" class="catboost-panel__control_checkbox" id="catboost-control2-log'+this.index+'"></input><label for="catboost-control2-log'+this.index+'" class="catboost-panel__controls2_label">Logarithm</label><div><input type="checkbox" class="catboost-panel__control_checkbox" id="catboost-control2-smooth'+this.index+'"></input><label for="catboost-control2-smooth'+this.index+'" class="catboost-panel__controls2_label">Smooth</label><input id="catboost-control2-slider'+this.index+'" disabled="disabled" class="catboost-panel__control_slider" type ="range" value="0" min="0" max="1" step ="0.01" for="rangeInputValue" name="rangeInput"/><input id="catboost-control2-slidervalue'+this.index+'" disabled="disabled" class="catboost-panel__control_slidervalue" value="0" min="0" max="1" for="rangeInput" name="rangeInputValue"/></div>'+e+'</div></div><div class="catboost-graph"><div class="catboost-graph__tabs"></div><div class="catboost-graph__charts"></div></div></div>'),$(t).append(this.layout),this.addTabEvents(),this.addControlEvents()}},t.prototype.addTabEvents=function(){var t=this;$(".catboost-graph__tabs",this.layout).click((function(e){if($(e.target).is(".catboost-graph__tab:not(.catboost-graph__tab_active)")){var a=$(e.target).attr("tabid");t.activeTab=a,$(".catboost-graph__tab_active",t.layout).removeClass("catboost-graph__tab_active"),$(".catboost-graph__chart_active",t.layout).removeClass("catboost-graph__chart_active"),$('.catboost-graph__tab[tabid="'+a+'"]',t.layout).addClass("catboost-graph__tab_active"),$('.catboost-graph__chart[tabid="'+a+'"]',t.layout).addClass("catboost-graph__chart_active"),t.cleanSeries(),t.redrawActiveChart(),t.resizeCharts()}}))},t.prototype.addControlEvents=function(){var t=this;$("#catboost-control-learn"+this.index,this.layout).click((function(){t.layoutDisabled.learn=!$(this)[0].checked,$(".catboost-panel__series",t.layout).toggleClass("catboost-panel__series_learn_disabled",t.layoutDisabled.learn),t.redrawActiveChart()})),$("#catboost-control-test"+this.index,this.layout).click((function(){t.layoutDisabled.test=!$(this)[0].checked,$(".catboost-panel__series",t.layout).toggleClass("catboost-panel__series_test_disabled",t.layoutDisabled.test),t.redrawActiveChart()})),$("#catboost-control2-clickmode"+this.index,this.layout).click((function(){t.clickMode=$(this)[0].checked})),$("#catboost-control2-log"+this.index,this.layout).click((function(){t.logarithmMode=$(this)[0].checked?"log":"linear",t.forEveryLayout((function(e){e.yaxis={type:t.logarithmMode}})),t.redrawActiveChart()}));var e=$("#catboost-control2-slider"+this.index),a=$("#catboost-control2-slidervalue"+this.index);$("#catboost-control2-smooth"+this.index,this.layout).click((function(){var s=$(this)[0].checked;t.setSmoothness(s?t.lastSmooth:-1),e.prop("disabled",!s),a.prop("disabled",!s),t.redrawActiveChart()})),$("#catboost-control2-cvstddev"+this.index,this.layout).click((function(){var e=$(this)[0].checked;t.setStddev(e),t.redrawActiveChart()})),e.on("input change",(function(){var e=Number($(this).val());a.val(isNaN(e)?0:e),t.setSmoothness(e),t.lastSmooth=e,t.redrawActiveChart()})),a.on("input change",(function(){var a=Number($(this).val());e.val(isNaN(a)?0:a),t.setSmoothness(a),t.lastSmooth=a,t.redrawActiveChart()}))},t.prototype.setTraceVisibility=function(t,e){t&&(t.visible=e)},t.prototype.updateTracesVisibility=function(){var t,e=this.groupTraces(),a=-1===this.getSmoothness(),s=this;for(var o in e)e.hasOwnProperty(o)&&(t=e[o].traces,this.layoutDisabled.traces[o]?t.forEach((function(t){s.setTraceVisibility(t,!1)})):(t.forEach((function(t){s.setTraceVisibility(t,!0)})),this.hasCVMode&&(this.stddevEnabled?(s.filterTracesOne(t,{type:"learn"}).forEach((function(t){s.setTraceVisibility(t,!1)})),s.filterTracesOne(t,{type:"test"}).forEach((function(t){s.setTraceVisibility(t,!1)})),s.filterTracesEvery(t,this.getTraceDefParams({type:"learn",cv_avg:!0})).forEach((function(t){s.setTraceVisibility(t,!0)})),s.filterTracesEvery(t,this.getTraceDefParams({type:"test",cv_avg:!0})).forEach((function(t){s.setTraceVisibility(t,!0)})),s.filterTracesEvery(t,this.getTraceDefParams({type:"learn",cv_avg:!0,smoothed:!0})).forEach((function(t){s.setTraceVisibility(t,!0)})),s.filterTracesEvery(t,this.getTraceDefParams({type:"test",cv_avg:!0,smoothed:!0})).forEach((function(t){s.setTraceVisibility(t,!0)})),s.filterTracesEvery(t,this.getTraceDefParams({type:"test",cv_avg:!0,best_point:!0})).forEach((function(t){s.setTraceVisibility(t,!0)})),s.filterTracesOne(t,{cv_stddev_first:!0}).forEach((function(t){s.setTraceVisibility(t,!0)})),s.filterTracesOne(t,{cv_stddev_last:!0}).forEach((function(t){s.setTraceVisibility(t,!0)}))):(s.filterTracesOne(t,{cv_stddev_first:!0}).forEach((function(t){s.setTraceVisibility(t,!1)})),s.filterTracesOne(t,{cv_stddev_last:!0}).forEach((function(t){s.setTraceVisibility(t,!1)})),s.filterTracesEvery(t,this.getTraceDefParams({type:"learn",cv_avg:!0})).forEach((function(t){s.setTraceVisibility(t,!1)})),s.filterTracesEvery(t,this.getTraceDefParams({type:"test",cv_avg:!0})).forEach((function(t){s.setTraceVisibility(t,!1)})),s.filterTracesEvery(t,this.getTraceDefParams({type:"learn",cv_avg:!0,smoothed:!0})).forEach((function(t){s.setTraceVisibility(t,!1)})),s.filterTracesEvery(t,this.getTraceDefParams({type:"test",cv_avg:!0,smoothed:!0})).forEach((function(t){s.setTraceVisibility(t,!1)})),s.filterTracesEvery(t,this.getTraceDefParams({type:"test",cv_avg:!0,best_point:!0})).forEach((function(t){s.setTraceVisibility(t,!1)})))),a&&s.filterTracesOne(t,{smoothed:!0}).forEach((function(t){s.setTraceVisibility(t,!1)})),this.layoutDisabled.learn&&s.filterTracesOne(t,{type:"learn"}).forEach((function(t){s.setTraceVisibility(t,!1)})),this.layoutDisabled.test&&s.filterTracesOne(t,{type:"test"}).forEach((function(t){s.setTraceVisibility(t,!1)}))))},t.prototype.getSmoothness=function(){return this.smoothness&&this.smoothness>-1?this.smoothness:-1},t.prototype.setSmoothness=function(t){t<0&&-1!==t||t>1||(this.smoothness=t)},t.prototype.setStddev=function(t){this.stddevEnabled=t},t.prototype.redrawActiveChart=function(){this.chartsToRedraw[this.activeTab]=!0,this.redrawAll()},t.prototype.redraw=function(){this.chartsToRedraw[this.activeTab]&&(this.chartsToRedraw[this.activeTab]=!1,this.updateTracesVisibility(),this.updateTracesCV(),this.updateTracesBest(),this.updateTracesValues(),this.updateTracesSmoothness(),this.plotly.redraw(this.traces[this.activeTab].parent)),this.drawTraces()},t.prototype.addRedrawFunc=function(){this.redrawFunc=function(t,e,a,s){var o=typeof a;"undefined"===o?a=!0:3===arguments.length&&"boolean"!==o&&(s=a,a=!0);var r,i,c,n=function(){c?(t.apply(s,i),c=!1,r=setTimeout(n,e)):r=null};return function(){i=arguments,s||(s=this),c=!0,r||(a?n():r=setTimeout(n,e))}}(this.redraw,400,!1,this)},t.prototype.redrawAll=function(){this.redrawFunc||this.addRedrawFunc(),this.redrawFunc()},t.prototype.addPoints=function(t,e){var a=this;e.chunks.forEach((function(s){void 0!==s.remaining_time&&void 0!==s.passed_time&&(a.timeLeft[e.path]||(a.timeLeft[e.path]=[]),a.timeLeft[e.path][s.iteration]=[s.remaining_time,s.passed_time]),["test","learn"].forEach((function(o){for(var r=a.meta[e.path][o+"_sets"],i=a.meta[e.path][o+"_metrics"],c=0;c<i.length;c++){var n=i[c].name,l=!1;hovertextParametersAdded=!1,a.lossFuncs[n]=i[c].best_value;for(var h=0;h<r.length;h++){var d=r[h],p={chartName:n,index:c,train:e.train,type:o,path:e.path,indexOfSet:h,nameOfSet:d},v=a.getKey(p),_=a.getLaunchMode(e.path);a.activeTab||(a.activeTab=v.chartId),"CV"===_&&(a.hasCVMode=!0,a.isCVinited||(a.layoutDisabled.learn=!0,a.setStddev(!0),a.isCVinited=!0));var u=s[d],f=u[c],b=s.iteration,m=a.getTrace(t,p),y=a.getTrace(t,$.extend({smoothed:!0},p)),g=null;if("test"===o&&("CV"!==_&&a.getTrace(t,$.extend({best_point:!0},p)),"number"==typeof a.lossFuncs[n]&&(g=a.getTrace(t,$.extend({best_value:!0},p)))),"inf"!==f&&"nan"!==f){if(m.x[b]=b,m.y[b]=u[c],m.hovertext[b]=d+": "+u[c].toPrecision(7),s.hasOwnProperty("parameters")){for(var T in a.hovertextParameters[b]="",s.parameters[0])s.parameters[0].hasOwnProperty(T)&&(valueOfParameter=s.parameters[0][T],a.hovertextParameters[b]+="<br>"+T+" : "+valueOfParameter);hovertextParametersAdded||"test"!==o||(hovertextParametersAdded=!0,m.hovertext[b]+=a.hovertextParameters[b])}y.x[b]=b}g&&(g.x[b]=b,g.y[b]=a.lossFuncs[n]),"CV"!==_||l||(l=!0,a.getTrace(t,$.extend({cv_stddev_first:!0},p)),a.getTrace(t,$.extend({cv_stddev_last:!0},p)),a.getTrace(t,$.extend({cv_stddev_first:!0,smoothed:!0},p)),a.getTrace(t,$.extend({cv_stddev_last:!0,smoothed:!0},p)),a.getTrace(t,$.extend({cv_avg:!0},p)),a.getTrace(t,$.extend({cv_avg:!0,smoothed:!0},p)),"test"===o&&a.getTrace(t,$.extend({cv_avg:!0,best_point:!0},p)))}a.chartsToRedraw[v.chartId]=!0,a.redrawAll()}}))}))},t.prototype.getLaunchMode=function(t){return this.meta[t].launch_mode},t.prototype.getChartNode=function(t,e){var a=$('<div class="catboost-graph__chart" tabid="'+t.id+'"></div>');return e&&a.addClass("catboost-graph__chart_active"),a},t.prototype.getChartTab=function(t,e){var a=$('<div class="catboost-graph__tab" tabid="'+t.id+'">'+t.name+"</div>");return e&&a.addClass("catboost-graph__tab_active"),a},t.prototype.forEveryChart=function(t){for(var e in this.traces)this.traces.hasOwnProperty(e)&&t(this.traces[e])},t.prototype.forEveryLayout=function(t){this.forEveryChart((function(e){t(e.layout)}))},t.prototype.getChart=function(t,e){var a=e.id,s=this;if(this.charts[a])return this.charts[a];this.addLayout(t);var o=this.activeTab===e.id,r=this.getChartNode(e,o),i=this.getChartTab(e,o);return $(".catboost-graph__charts",this.layout).append(r),$(".catboost-graph__tabs",this.layout).append(i),this.traces[a]={id:e.id,name:e.name,parent:r[0],traces:[],layout:{xaxis:{range:[0,Number(this.meta[e.path].iteration_count)],type:"linear",tickmode:"auto",showspikes:!0,spikethickness:1,spikedash:"longdashdot",spikemode:"across",zeroline:!1,showgrid:!1},yaxis:{zeroline:!1},separators:". ",margin:{l:38,r:0,t:35,b:30},autosize:!0,showlegend:!1},options:{scrollZoom:!1,modeBarButtonsToRemove:["toggleSpikelines"],displaylogo:!1}},this.charts[a]=this.plotly.plot(r[0],this.traces[a].traces,this.traces[a].layout,this.traces[a].options),r[0].on("plotly_hover",(function(t){s.updateTracesValues(t.points[0].x)})),r[0].on("plotly_click",(function(t){s.updateTracesValues(t.points[0].x,!0)})),this.charts[a]},t.prototype.getTrace=function(t,e){var a=this.getKey(e),s=[];if(this.traces[a.chartId]&&(s=this.traces[a.chartId].traces.filter((function(t){return t.name===a.traceName}))),s.length)return s[0];this.getChart(t,{id:a.chartId,name:e.chartName,path:e.path});var o={color:this.getNextColor(e.path,e.smoothed?.2:1),fillsmoothcolor:this.getNextColor(e.path,.1),fillcolor:this.getNextColor(e.path,.4),hoverinfo:e.cv_avg?"skip":"text+x",width:e.cv_avg?2:1,dash:"test"===e.type?"solid":"dot"},r={name:a.traceName,_params:e,x:[],y:[],hovertext:[],hoverinfo:o.hoverinfo,line:{width:o.width,dash:o.dash,color:o.color},mode:"lines",hoveron:"points",connectgaps:!0};return e.best_point&&(r={name:a.traceName,_params:e,x:[],y:[],marker:{width:2,color:o.color},hovertext:[],hoverinfo:"text",mode:"markers",type:"scatter"}),e.best_value&&(r={name:a.traceName,_params:e,x:[],y:[],line:{width:1,dash:"dash",color:"#CCCCCC"},mode:"lines",connectgaps:!0,hoverinfo:"skip"}),e.cv_stddev_last&&(r.fill="tonexty"),r._params.plotParams=o,this.traces[a.chartId].traces.push(r),r},t.prototype.getKey=function(t){var e=[t.train,t.type,t.indexOfSet,t.smoothed?"smoothed":"",t.best_point?"best_pount":"",t.best_value?"best_value":"",t.cv_avg?"cv_avg":"",t.cv_stddev_first?"cv_stddev_first":"",t.cv_stddev_last?"cv_stddev_last":""].join(";");return{chartId:t.chartName,traceName:e,colorId:t.train}},t.prototype.filterTracesEvery=function(t,e){return(t=t||this.traces[this.activeTab].traces).filter((function(t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]!==t._params[a])return!1;return!0}))},t.prototype.filterTracesOne=function(t,e){return(t=t||this.traces[this.activeTab].traces).filter((function(t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t._params[a])return!0;return!1}))},t.prototype.cleanSeries=function(){$(".catboost-panel__series",this.layout).html("")},t.prototype.groupTraces=function(){var t=this.traces[this.activeTab].traces,e=0,a={};return t.map((function(t){var s=t._params.train;a[s]||(a[s]={index:e,traces:[],info:{path:t._params.path,color:t._params.plotParams.color}},e++),a[s].traces.push(t)})),a},t.prototype.drawTraces=function(){var t="",e=this.groupTraces(),a=$(".catboost-panel__series .catboost-panel__serie",this.layout).length;if(Object.keys(e).filter(hasOwnProperty.bind(e)).length!==a){for(var s in e)e.hasOwnProperty(s)&&(t+=this.drawTrace(s,e[s]));$(".catboost-panel__series",this.layout).html(t),this.updateTracesValues(),this.addTracesEvents()}},t.prototype.getTraceDefParams=function(t){var e={smoothed:void 0,best_point:void 0,best_value:void 0,cv_avg:void 0,cv_stddev_first:void 0,cv_stddev_last:void 0};return t?$.extend(e,t):e},t.prototype.drawTrace=function(t,e){var a=e.info,s="catboost-serie-"+this.index+"-"+e.index,o={learn:this.filterTracesEvery(e.traces,this.getTraceDefParams({type:"learn"})),test:this.filterTracesEvery(e.traces,this.getTraceDefParams({type:"test"}))},r={learn:{middle:"",bottom:""},test:{middle:"",bottom:""}},i="";return["learn","test"].forEach((function(t){o[t].forEach((function(e){r[t].middle+='<div class="catboost-panel__serie_'+t+'_pic" style="border-color:'+a.color+'"></div><div data-index="'+e._params.indexOfSet+'" class="catboost-panel__serie_'+t+'_value"></div>',r[t].bottom+='<div class="catboost-panel__serie_'+t+'_pic" style="border-color:transparent"></div><div data-index="'+e._params.indexOfSet+'" class="catboost-panel__serie_best_'+t+'_value"></div>',i+='<div class="catboost-panel__serie_'+t+'_pic" style="border-color:'+a.color+'"></div><div class="catboost-panel__serie_'+t+'_name">'+e._params.nameOfSet+"</div>"}))})),'<div id="'+s+'" class="catboost-panel__serie" style="color:'+a.color+'"><div class="catboost-panel__serie_top"><input type="checkbox" data-seriename="'+t+'" class="catboost-panel__serie_checkbox" id="'+s+'-box" '+(this.layoutDisabled.series[t]?"":'checked="checked"')+"></input><label title="+this.meta[a.path].name+' for="'+s+'-box" class="catboost-panel__serie_label">'+t+'<div class="catboost-panel__serie_time_left" title="Estimate time"></div></label>'+("Eval"!==this.getLaunchMode(a.path)?'<div class="catboost-panel__serie_time"><div class="catboost-panel__serie_time_spend" title="Time spend"></div></div>':"")+'</div><div class="catboost-panel__serie_hint catboost-panel__serie__learn_hint">curr</div><div class="catboost-panel__serie_hint catboost-panel__serie__test_hint">best</div><div class="catboost-panel__serie_iteration" title="curr iteration"></div><div class="catboost-panel__serie_best_iteration" title="best '+(this.hasCVMode?"avg ":"")+'iteration"></div><div class="catboost-panel__serie_scroll"><div class="catboost-panel__serie_names">'+i+'</div><div class="catboost-panel__serie_middle">'+r.learn.middle+r.test.middle+'</div><div class="catboost-panel__serie_bottom">'+r.learn.bottom+r.test.bottom+"</div></div></div>"},t.prototype.updateTracesValues=function(t,e){var a=this.groupTraces();for(var s in a)a.hasOwnProperty(s)&&!this.layoutDisabled.traces[s]&&this.updateTraceValues(s,a[s],t,e)},t.prototype.updateTracesBest=function(){var t=this.groupTraces();for(var e in t)t.hasOwnProperty(e)&&!this.layoutDisabled.traces[e]&&this.updateTraceBest(e,t[e])},t.prototype.getBestValue=function(t){if(!t.length)return{best:void 0,index:-1};for(var e=t[0],a=0,s=this.lossFuncs[this.traces[this.activeTab].name],o="number"==typeof s?Math.abs(t[0]-s):0,r=1,i=t.length;r<i;r++)"Min"===s&&t[r]<e&&(e=t[r],a=r),"Max"===s&&t[r]>e&&(e=t[r],a=r),"number"==typeof s&&Math.abs(t[r]-s)<o&&(e=t[r],o=Math.abs(t[r]-s),a=r);return{best:e,index:a,func:s}},t.prototype.updateTracesCV=function(){this.updateTracesCVAvg(),this.hasCVMode&&this.stddevEnabled&&this.updateTracesCVStdDev()},t.prototype.updateTracesCVAvg=function(){var t=this.groupTraces(),e=this.filterTracesEvery(t.traces,this.getTraceDefParams({cv_avg:!0})),a=this;e.forEach((function(e){var s=a.filterTracesEvery(t.traces,a.getTraceDefParams({train:e._params.train,type:e._params.type,smoothed:e._params.smoothed}));s.length&&a.cvAvgFunc(s,e)}))},t.prototype.cvAvgFunc=function(t,e){var a,s,o=t.length,r=-1;t.forEach((function(t){t.y.length>r&&(r=t.y.length)}));for(var i=0;i<r;i++){s=0,a=0;for(var c=0;c<o;c++)void 0!==t[c].y[i]&&(s+=t[c].y[i],a++);a>0&&(e.x[i]=i,e.y[i]=s/a)}},t.prototype.updateTracesCVStdDev=function(){var t=this.groupTraces(),e=this.filterTracesOne(t.traces,{cv_stddev_first:!0}),a=this;e.forEach((function(e){var s=a.filterTracesEvery(t.traces,a.getTraceDefParams({train:e._params.train,type:e._params.type,smoothed:e._params.smoothed})),o=a.filterTracesEvery(t.traces,a.getTraceDefParams({train:e._params.train,type:e._params.type,smoothed:e._params.smoothed,cv_stddev_last:!0}));s.length&&1===o.length&&a.cvStdDevFunc(s,e,o[0])}))},t.prototype.cvStdDevFunc=function(t,e,a){var s,o,r,i,c=t.length,n=-1;for(t.forEach((function(t){t.y.length>n&&(n=t.y.length)})),r=0;r<n;r++){for(o=0,s=0,i=0;i<c;i++)void 0!==t[i].y[r]&&(o+=t[i].y[r],s++);if(!(s<=0)){var l=0,h=o/s;for(i=0;i<c;i++)void 0!==t[i].y[r]&&(l+=Math.pow(t[i].y[r]-h,2));l/=s-1,l=Math.pow(l,.5),e.x[r]=r,e.y[r]=h-l,e.hovertext[r]=e._params.type+" std: "+h.toFixed(7)+"-"+l.toFixed(7),a.x[r]=r,a.y[r]=h+l,a.hovertext[r]=a._params.type+" std: "+h.toFixed(7)+"+"+l.toFixed(7),this.hovertextParameters.length>r&&(e.hovertext[r]+=this.hovertextParameters[r],a.hovertext[r]+=this.hovertextParameters[r])}}},t.prototype.updateTracesSmoothness=function(){var t=this.groupTraces(),e=this.filterTracesOne(t.traces,{smoothed:!0}),a=this.getSmoothness()>-1,s=this;e.forEach((function(e){var o=s.filterTracesEvery(t.traces,s.getTraceDefParams({train:e._params.train,type:e._params.type,indexOfSet:e._params.indexOfSet,cv_avg:e._params.cv_avg,cv_stddev_first:e._params.cv_stddev_first,cv_stddev_last:e._params.cv_stddev_last})),r=!1;1===o.length&&(o=o[0]).visible&&(a&&(s.smoothFunc(o,e),r=!0),s.highlightSmoothedTrace(o,e,r))}))},t.prototype.highlightSmoothedTrace=function(t,e,a){a?(e.line.color=t._params.plotParams.color,t.line.color=e._params.plotParams.color,t.hoverinfo="skip",t._params.cv_stddev_last&&(t.fillcolor=t._params.plotParams.fillsmoothcolor)):(t.line.color=t._params.plotParams.color,t.hoverinfo=t._params.plotParams.hoverinfo,t._params.cv_stddev_last&&(t.fillcolor=t._params.plotParams.fillcolor))},t.prototype.smoothFunc=function(t,e){var a=t.y,s=this.smooth(a,this.getSmoothness()),o=0,r=this;s.length&&a.forEach((function(t,a){e.x[a]||(e.x[a]=a);var i=e._params.nameOfSet;(e._params.cv_stddev_first||e._params.cv_stddev_last)&&(i=e._params.type+" std"),e.y[a]=s[o],e.hovertext[a]=i+"`: "+s[o].toPrecision(7),r.hovertextParameters.length>a&&(e.hovertext[a]+=r.hovertextParameters[a]),o++}))},t.prototype.formatItemValue=function(t,e,a){return void 0===t?"":'<span title="'+(a=a||"")+"value "+t+'">'+t+"</span>"},t.prototype.updateTraceBest=function(t,e){var a=this.filterTracesOne(e.traces,{best_point:!0}),s=this;a.forEach((function(t){var a=s.filterTracesEvery(e.traces,s.getTraceDefParams({train:t._params.train,type:"test",indexOfSet:t._params.indexOfSet}));s.hasCVMode&&(a=s.filterTracesEvery(e.traces,s.getTraceDefParams({train:t._params.train,type:"test",cv_avg:!0})));var o=s.getBestValue(1===a.length?a[0].y:[]);-1!==o.index&&(t.x[0]=o.index,t.y[0]=o.best,t.hovertext[0]=o.func+" ("+(s.hasCVMode?"avg":t._params.nameOfSet)+"): "+o.index+" "+o.best)}))},t.prototype.updateTraceValues=function(t,e,a,s){var o="catboost-serie-"+this.index+"-"+e.index,r={learn:this.filterTracesEvery(e.traces,this.getTraceDefParams({type:"learn"})),test:this.filterTracesEvery(e.traces,this.getTraceDefParams({type:"test"}))},i=e.info.path,c=this;if(["learn","test"].forEach((function(t){r[t].forEach((function(r){var n=r.y||[],l=void 0!==a&&a<n.length-1?a:n.length-1,h=n.length?n[l]:void 0,d=c.filterTracesEvery(e.traces,c.getTraceDefParams({type:"test",indexOfSet:r._params.indexOfSet})),p=c.getBestValue(1===d.length?d[0].y:[]),v="",_="";!s&&c.clickMode||($("#"+o+" .catboost-panel__serie_"+t+"_value[data-index="+r._params.indexOfSet+"]",c.layout).html(c.formatItemValue(h,l,t+" ")),$("#"+o+" .catboost-panel__serie_iteration",c.layout).html(l),c.timeLeft[i]&&c.timeLeft[i][n.length-1]&&(v=c.timeLeft[i][n.length-1][0]),$("#"+o+" .catboost-panel__serie_time_left",c.layout).html(v?"~"+c.convertTime(v):""),c.timeLeft[i]&&c.timeLeft[i][l]&&(_=c.timeLeft[i][l][1]),$("#"+o+" .catboost-panel__serie_time_spend",c.layout).html(c.convertTime(_)),$("#"+o+" .catboost-panel__serie_best_iteration",c.layout).html(p.index>-1?p.index:""),$("#"+o+" .catboost-panel__serie_best_test_value[data-index="+r._params.indexOfSet+"]",c.layout).html(c.formatItemValue(p.best,p.index,"best "+r._params.nameOfSet+" ")))}))})),this.hasCVMode){var n=this.filterTracesEvery(e.traces,this.getTraceDefParams({type:"test",cv_avg:!0})),l=this.getBestValue(1===n.length?n[0].y:[]);$("#"+o+" .catboost-panel__serie_best_iteration",this.layout).html(l.index>-1?l.index:"")}s&&(this.clickMode=!0,$("#catboost-control2-clickmode"+this.index,this.layout)[0].checked=!0)},t.prototype.addTracesEvents=function(){var t=this;$(".catboost-panel__serie_checkbox",this.layout).click((function(){var e=$(this).data("seriename");t.layoutDisabled.traces[e]=!$(this)[0].checked,t.redrawActiveChart()}))},t.prototype.getNextColor=function(t,e){var a;return this.colorsByPath[t]?a=this.colorsByPath[t]:(a=this.colors[this.colorIndex],this.colorsByPath[t]=a,this.colorIndex++,this.colorIndex>this.colors.length-1&&(this.colorIndex=0)),this.hexToRgba(a,e)},t.prototype.hexToRgba=function(t,e){t.length<6&&(t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])/i,(function(t,e,a,s){return"#"+e+e+a+a+s+s})));var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})/i.exec(t);return"rgba("+parseInt(a[1],16)+","+parseInt(a[2],16)+","+parseInt(a[3],16)+","+e+")"},t.prototype.convertTime=function(t){if(!t)return"0s";var e=(t=Math.floor(1e3*t))%1e3,a=(t=parseInt(t/1e3,10))%60,s=(t=parseInt(t/60,10))%60,o=(t=parseInt(t/60,10))%24,r="";return o&&o>0&&(r+=o+"h ",a=0,e=0),s&&s>0&&(r+=s+"m ",e=0),a&&a>0&&(r+=a+"s "),e&&e>0&&(r+=e+"ms"),r.trim()},t.prototype.mean=function(t,e){var a,s=t.length,o=s,r=-1,i=0,c=function(t){return null===t?NaN:+t};if(null===e)for(;++r<s;)isNaN(a=c(t[r]))?--o:i+=a;else for(;++r<s;)isNaN(a=c(e(t[r],r,t)))?--o:i+=a;if(o)return i/o},t.prototype.smooth=function(t,e){var a=(Math.pow(1e3,e)-1)/999,s=Math.floor(t.length*a/2),o=[],r=this;return t.forEach((function(e,a){var i=Math.min(s,a,t.length-a-1),c=a-i,n=a+i+1,l=e;isFinite(l)?o.push(r.mean(t.slice(c,n).filter((function(t){return isFinite(t)})),null)):o.push(l)})),o}},138:(t,e,a)=>{t.exports=a(294),t.exports.version=a(306).version}}]);